package test;

import java.util.List;
import java.util.Properties;

import javax.ejb.EJB;
import javax.naming.Context;
import javax.naming.InitialContext;

import org.junit.AfterClass;
import org.junit.BeforeClass;

import entity.Person;
import junit.framework.TestCase;
import sessionsBeans.KontoerRemote;
import sessionsBeans.PersonerRemote;

public class Tests extends TestCase {
	
	Context context;
	
	@EJB
	PersonerRemote personer;
	KontoerRemote kontoer;
	
	@BeforeClass
	public void setup() {
		Properties p = new Properties();
		p.put(Context.INITIAL_CONTEXT_FACTORY, "org.apache.openejb.client.RemoteInitialContextFactory");
		p.put("BankDBDatasource","new://Resource?type=DataSource");
		p.put("BankDBDatasource.JdbcDriver","org.hsqldb.jdbcDriver");
		p.put("BankDBDatasource.JdbcUrl","jdbc:hsqldb:file:data/bankdb/hsqldb");
		p.put("Unmanaged_BankDBDataSource","new://Resource?type=DataSource");
		p.put("Unmanaged_BankDBDataSource.JdbcDriver","org.hsqldb.jdbcDriver");
		p.put("Unmanaged_BankDBDataSource.JdbcUrl","jdbc:hsqldb:file:data/bankdb/hsqldb");
		p.put("Unmanaged_BankDBDataSource.JtaManaged","false");
		
		try {
			context= new InitialContext(p);
			personer= (PersonerRemote)context.lookup("PersonerRemote");
			kontoer= (KontoerRemote)context.lookup("KontoerRemote");
			
		} catch(Exception e) {
			System.out.println("Error, could not connect to remote: ");
			e.printStackTrace();
		}	
	}
	
	
	@AfterClass
	public void tearDown() {
		
		//remove all personer
		try{
			List<Person> list = personer.list();
			for(Person pers : list) {
				if(pers.getId() > 0) {
					personer.remove(pers);
					System.out.println("Deleting ... : "+ pers.getFodselsdato() + " -" + 
					pers.getFodselsnummer() + ": "+ pers.getNavn());
					}
				else {
					System.out.println("Delete failed ... : "+ pers.getFodselsdato() + "-"+ pers.getFodselsnummer() + ": "+ pers.getNavn());
					}
			}
		} catch (Exception e) {
			System.out.println("Error, could not remove personer from list: ");
			e.printStackTrace();
		}
		finally {
		}
	}

}
